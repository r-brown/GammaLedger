<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GammaLedger</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="icon" type="image/png" href="favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="64x64" href="favicon-64x64.png">
</head>

<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>GammaLedger</h2>
            </div>
            <nav class="sidebar-nav">
                <button class="nav-item active" data-view="dashboard">
                    <span class="nav-icon">üìä</span>
                    Dashboard
                </button>
                <button class="nav-item" data-view="trades-list">
                    <span class="nav-icon">üìã</span>
                    All Trades
                </button>
                <button class="nav-item" data-view="add-trade">
                    <span class="nav-icon">‚ûï</span>
                    Add Trade
                </button>
                <button class="nav-item" data-view="import">
                    <span class="nav-icon">‚¨ÜÔ∏è</span>
                    Import
                </button>
                <button class="nav-item" data-view="settings">
                    <span class="nav-icon">‚öôÔ∏è</span>
                    Settings
                </button>
            </nav>
            <div class="sidebar-footer">
                <a class="sidebar-link" href="https://gammaledger.com" target="_blank" rel="noopener noreferrer">
                    <span class="nav-icon" aria-hidden="true">üåê</span>
                    <span>GammaLedger.com</span>
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="app-header">
                <div class="header-left">
                    <h1 id="page-title">Options Trading Dashboard</h1>
                </div>

                <div class="header-right">
                    <div class="file-management">
                        <button class="btn btn--sm btn--secondary" id="new-database-btn">New Database</button>
                        <button class="btn btn--sm btn--secondary" id="load-database-btn">Load Database</button>
                        <button class="btn btn--sm btn--primary" id="save-database-btn">Save Database</button>
                        <div id="loading-indicator" class="loading-indicator hidden">Saving...</div>
                    </div>
                    <div class="file-info">
                        <span id="current-file-name" class="file-name">Unsaved Database</span>
                        <span id="unsaved-indicator" class="unsaved-indicator hidden">‚óè</span>
                    </div>
                </div>
            </header>

            <!-- Browser Compatibility Notice -->
            <div id="compatibility-notice" class="compatibility-notice hidden">
                <div class="notice-content">
                    <h4>‚ö†Ô∏è Limited File System Support</h4>
                    <p>Your browser doesn't fully support the File System Access API. You can still export/import data
                        using download/upload methods.</p>
                    <button class="btn btn--sm btn--secondary"
                        onclick="this.parentElement.parentElement.classList.add('hidden')">Dismiss</button>
                </div>
            </div>

            <!-- Enhanced Dashboard View with Integrated Analytics -->
            <div class="view dashboard-view active">
                <!-- Portfolio Overview -->
                <div class="portfolio-overview">
                    <div class="overview-cards">
                        <div class="overview-card">
                            <h3>Total P&L</h3>
                            <p class="card-value" id="total-pl">$0.00</p>
                            <small class="card-subtitle" id="pl-percentage">0% Portfolio</small>
                        </div>
                        <div class="overview-card">
                            <h3>Win Rate</h3>
                            <p class="card-value" id="win-rate">0%</p>
                            <small class="card-subtitle" id="win-loss-count">0W / 0L</small>
                        </div>
                        <div class="overview-card">
                            <h3>Profit Factor</h3>
                            <p class="card-value" id="profit-factor">0.00</p>
                            <small class="card-subtitle">Risk/Reward</small>
                        </div>
                        <div class="overview-card">
                            <h3>Active Positions</h3>
                            <p class="card-value" id="active-positions">0</p>
                            <small class="card-subtitle">Positions</small>
                        </div>
                        <div class="overview-card">
                            <h3>Total ROI</h3>
                            <p class="card-value" id="total-roi">0%</p>
                            <small class="card-subtitle">Annualized</small>
                        </div>
                        <div class="overview-card">
                            <h3>Max Drawdown</h3>
                            <p class="card-value" id="max-drawdown">0%</p>
                            <small class="card-subtitle">Peak to Trough</small>
                        </div>
                    </div>
                </div>

                <!-- Monthly P&L Performance - Full Width -->
                <div class="monthly-pl-section">
                    <div class="chart-container chart-full-width">
                        <h3>Monthly P&L Performance</h3>
                        <div class="chart-responsive-wrapper chart-responsive-wrapper--tall">
                            <canvas id="monthlyPLChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Cumulative P&L Growth - Full Width -->
                <div class="cumulative-pl-section">
                    <div class="chart-container chart-full-width">
                        <h3>Cumulative P&L Growth</h3>
                        <div class="chart-responsive-wrapper chart-responsive-wrapper--medium">
                            <canvas id="cumulativePLChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Strategy Analysis Row -->
                <div class="strategy-analysis-row">
                    <div class="chart-container">
                        <h3>Strategy Performance</h3>
                        <div class="chart-responsive-wrapper chart-responsive-wrapper--medium">
                            <canvas id="strategyChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-container">
                        <h3>Win Rate by Strategy</h3>
                        <div class="chart-responsive-wrapper chart-responsive-wrapper--medium">
                            <canvas id="winRateChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Fees & Ticker Analytics -->
                <div class="advanced-analytics-row">
                    <div class="chart-container">
                        <h3>Commission Impact</h3>
                        <div class="chart-responsive-wrapper chart-responsive-wrapper--short">
                            <canvas id="commissionImpactChart"></canvas>
                        </div>
                        <p class="chart-subtext" id="commissionImpactSummary">No closed trades yet.</p>
                    </div>
                    <div class="chart-container heatmap-container">
                        <h3>Ticker Performance Heatmap</h3>
                        <div id="tickerHeatmap" class="heatmap-grid" aria-live="polite"></div>
                    </div>
                </div>

                <!-- Holding Period & Projections -->
                <div class="advanced-analytics-row">
                    <div class="chart-container">
                        <h3>Time in Trade (Average Days)</h3>
                        <div class="chart-responsive-wrapper chart-responsive-wrapper--short">
                            <canvas id="timeInTradeChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-container">
                        <h3>Monte Carlo Projection (60 Days)</h3>
                        <div class="chart-responsive-wrapper chart-responsive-wrapper--medium">
                            <canvas id="monteCarloChart"></canvas>
                        </div>
                        <p class="chart-subtext" id="monteCarloSummary">Need more closed trades to run projections.</p>
                    </div>
                </div>

                <!-- Performance Gauges -->
                <div class="advanced-analytics-gauges">
                    <div class="chart-container gauge-card">
                        <h3>Sharpe Ratio</h3>
                        <div class="chart-responsive-wrapper chart-responsive-wrapper--compact">
                            <canvas id="sharpeGaugeChart"></canvas>
                        </div>
                        <p class="chart-metric" id="sharpeGaugeValue">‚Äî</p>
                        <p class="chart-subtext">Risk-adjusted return</p>
                    </div>
                    <div class="chart-container gauge-card">
                        <h3>Sortino Ratio</h3>
                        <div class="chart-responsive-wrapper chart-responsive-wrapper--compact">
                            <canvas id="sortinoGaugeChart"></canvas>
                        </div>
                        <p class="chart-metric" id="sortinoGaugeValue">‚Äî</p>
                        <p class="chart-subtext">Focus on downside risk</p>
                    </div>
                </div>

                <!-- Active Positions & Recent Trades -->
                <div class="dashboard-tables">
                    <div class="active-positions">
                        <h3>Active Positions</h3>
                        <div class="table-container stackable-table-container">
                            <table id="active-positions-table" class="stackable-table">
                                <thead>
                                    <tr>
                                        <th>Ticker</th>
                                        <th>Strategy</th>
                                        <th>Strike</th>
                                        <th>Current Price</th>
                                        <th>DTE</th>
                                        <th>Max Risk</th>
                                        <th class="notes-col">Notes</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>

                    <div class="recent-trades">
                        <h3>Recent Closed Trades</h3>
                        <div class="table-container stackable-table-container">
                            <table id="recent-trades-table" class="stackable-table">
                                <thead>
                                    <tr>
                                        <th>Ticker</th>
                                        <th>Strategy</th>
                                        <th>Exit Date</th>
                                        <th>Days Held</th>
                                        <th>P&L</th>
                                        <th>ROI</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Add Trade View -->
            <div class="view add-trade-view">
                <form id="add-trade-form" class="trade-form">
                    <div class="form-sections">
                        <!-- Basic Trade Info -->
                        <section class="form-section">
                            <h3>Basic Trade Information</h3>
                            <p class="form-help-text">Opened, expiration, and closed dates are automatically derived from leg activity.</p>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="ticker">Ticker Symbol</label>
                                    <input type="text" id="ticker" name="ticker" class="form-control" required>
                                    <div class="ticker-preview" id="ticker-preview"></div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="underlyingType">Underlying Type</label>
                                    <select id="underlyingType" name="underlyingType" class="form-control">
                                        <option value="Stock" selected>Stock</option>
                                        <option value="ETF">ETF</option>
                                        <option value="Index">Index</option>
                                        <option value="Future">Future</option>
                                    </select>
                                    <p class="form-help-text">Choose the asset category so GammaLedger can apply the right contract multiplier.</p>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="strategy">Strategy</label>
                                    <select id="strategy" name="strategy" class="form-control" required>
                                        <option value="">Select Strategy</option>
                                        <option value="Bear Call Ladder">Bear Call Ladder</option>
                                        <option value="Bear Call Spread">Bear Call Spread</option>
                                        <option value="Bear Put Ladder">Bear Put Ladder</option>
                                        <option value="Bear Put Spread">Bear Put Spread</option>
                                        <option value="Bull Call Ladder">Bull Call Ladder</option>
                                        <option value="Bull Call Spread">Bull Call Spread</option>
                                        <option value="Bull Put Ladder">Bull Put Ladder</option>
                                        <option value="Bull Put Spread">Bull Put Spread</option>
                                        <option value="Calendar Call Spread">Calendar Call Spread</option>
                                        <option value="Calendar Put Spread">Calendar Put Spread</option>
                                        <option value="Call Broken Wing">Call Broken Wing</option>
                                        <option value="Call Ratio Backspread">Call Ratio Backspread</option>
                                        <option value="Call Ratio Spread">Call Ratio Spread</option>
                                        <option value="Cash-Secured Put">‚≠ê Cash-Secured Put</option>
                                        <option value="Collar">Collar</option>
                                        <option value="Covered Call">‚≠ê Covered Call</option>
                                        <option value="Covered Short Straddle">Covered Short Straddle</option>
                                        <option value="Covered Short Strangle">Covered Short Strangle</option>
                                        <option value="Diagonal Call Spread">Diagonal Call Spread</option>
                                        <option value="Diagonal Put Spread">Diagonal Put Spread</option>
                                        <option value="Double Diagonal">Double Diagonal</option>
                                        <option value="Guts">Guts</option>
                                        <option value="Inverse Call Broken Wing">Inverse Call Broken Wing</option>
                                        <option value="Inverse Iron Butterfly">Inverse Iron Butterfly</option>
                                        <option value="Inverse Iron Condor">Inverse Iron Condor</option>
                                        <option value="Inverse Put Broken Wing">Inverse Put Broken Wing</option>
                                        <option value="Iron Butterfly">Iron Butterfly</option>
                                        <option value="Iron Condor">Iron Condor</option>
                                        <option value="Jade Lizard">Jade Lizard</option>
                                        <option value="Long Call">Long Call</option>
                                        <option value="Long Call Butterfly">Long Call Butterfly</option>
                                        <option value="Long Call Condor">Long Call Condor</option>
                                        <option value="Long Combo">Long Combo</option>
                                        <option value="Long Put">Long Put</option>
                                        <option value="Long Put Butterfly">Long Put Butterfly</option>
                                        <option value="Long Put Condor">Long Put Condor</option>
                                        <option value="Long Synthetic Future">Long Synthetic Future</option>
                                        <option value="Poor Man's Covered Call">‚≠ê Poor Man's Covered Call</option>
                                        <option value="Protective Put">Protective Put</option>
                                        <option value="Put Broken Wing">Put Broken Wing</option>
                                        <option value="Put Ratio Backspread">Put Ratio Backspread</option>
                                        <option value="Put Ratio Spread">Put Ratio Spread</option>
                                        <option value="Reverse Jade Lizard">Reverse Jade Lizard</option>
                                        <option value="Short Call">Short Call</option>
                                        <option value="Short Call Butterfly">Short Call Butterfly</option>
                                        <option value="Short Call Condor">Short Call Condor</option>
                                        <option value="Short Combo">Short Combo</option>
                                        <option value="Short Guts">Short Guts</option>
                                        <option value="Short Put">Short Put</option>
                                        <option value="Short Put Butterfly">Short Put Butterfly</option>
                                        <option value="Short Put Condor">Short Put Condor</option>
                                        <option value="Short Straddle">Short Straddle</option>
                                        <option value="Short Strangle">Short Strangle</option>
                                        <option value="Short Synthetic Future">Short Synthetic Future</option>
                                        <option value="Straddle">Straddle</option>
                                        <option value="Strap">Strap</option>
                                        <option value="Strangle">Strangle</option>
                                        <option value="Strip">Strip</option>
                                        <option value="Synthetic Put">Synthetic Put</option>
                                        <option value="Wheel">‚≠ê Wheel</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="tradeStatus">Trade Status</label>
                                    <select id="tradeStatus" name="tradeStatus" class="form-control">
                                        <option value="">Auto (based on legs)</option>
                                        <option value="Open">Open</option>
                                        <option value="Closed">Closed</option>
                                        <option value="Rolling">Rolled</option>
                                        <option value="Expired">Expired</option>
                                        <option value="Assigned">Assigned</option>
                                    </select>
                                    <p class="form-help-text">Leave on Auto for lifecycle detection or pick a status to override it.</p>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="exitReason">Exit Reason (if closed)</label>
                                    <select id="exitReason" name="exitReason" class="form-control">
                                        <option value="">Select reason</option>
                                        <option value="Profit target reached">Profit target reached</option>
                                        <option value="Early profit take">Early profit take</option>
                                        <option value="Stop loss triggered">Stop loss triggered</option>
                                        <option value="Expired">Expired</option>
                                        <option value="Assignment">Assignment</option>
                                        <option value="Rolling position">Rolling position</option>
                                        <option value="Time decay">Time decay</option>
                                        <option value="Market change">Market change</option>
                                        <option value="Volatility crush">Volatility crush</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="notes">Notes</label>
                                    <textarea id="notes" name="notes" class="form-control" rows="4"
                                        placeholder="Capture market context, execution details, and risk management plans."></textarea>
                                </div>
                            </div>
                        </section>
                        <!-- Trade Legs -->
                        <section class="form-section">
                            <div class="form-section__header">
                                <h3>Trade Legs</h3>
                                <p class="form-help-text">Add one or more legs to fully describe this trade. Each leg represents a single execution (including rolls).</p>
                            </div>
                            <div id="trade-legs-container" class="trade-legs-container" aria-live="polite"></div>
                            <div class="form-row trade-legs-actions">
                                <button type="button" class="btn btn--secondary" id="add-leg-button">Add Leg</button>
                            </div>
                        </section>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn--secondary" id="cancel-trade">Cancel</button>
                        <button type="submit" class="btn btn--primary">Save Trade</button>
                    </div>
                </form>
            </div>

            <!-- Trades List View -->
            <div class="view trades-list-view">
                <div class="trades-header">
                    <div class="trades-header__controls">
                        <button type="button" class="btn btn--sm btn--secondary trades-filters-toggle" id="toggle-filters" aria-expanded="true" aria-controls="trades-filters-panel">
                            Hide Filters
                        </button>
                        <div class="trades-actions">
                            <button class="btn btn--secondary" id="trades-merge-toggle" aria-controls="trades-merge-panel" aria-expanded="false">Merge Trades</button>
                            <button class="btn btn--secondary" id="export-csv">Export CSV</button>
                        </div>
                    </div>
                    <div class="trades-filters is-open" id="trades-filters-panel">
                        <div class="trades-filters-grid trades-filters-grid--compact">
                            <select id="filter-strategy" class="form-control">
                                <option value="">All Strategies</option>
                            </select>
                            <select id="filter-status" class="form-control">
                                <option value="">All Status</option>
                                <option value="Open">Open</option>
                                <option value="Rolling">Rolling</option>
                                <option value="Closed">Closed</option>
                                <option value="Assigned">Assigned</option>
                                <option value="Expired">Expired</option>
                            </select>
                        </div>
                        <div class="trades-filters-search">
                            <input type="text" id="search-ticker" class="form-control" placeholder="Search ticker, strategy, or notes...">
                        </div>
                    </div>
                </div>
                <section class="trades-merge-panel is-collapsed" id="trades-merge-panel" aria-live="polite" aria-hidden="true">
                    <header class="trades-merge-panel__header">
                        <div>
                            <h3 class="trades-merge-panel__title">Merge Trades by Ticker</h3>
                            <p id="trades-merge-summary" class="trades-merge-panel__summary">Select two or more trades with the same ticker to enable merging.</p>
                        </div>
                        <button type="button" class="btn btn--secondary" id="trades-merge-btn" disabled>Merge Selected Trades</button>
                    </header>
                    <div id="trades-merge-groups" class="trades-merge-groups"></div>
                </section>
                <div class="table-container stackable-table-container">
                    <table id="trades-table" class="stackable-table">
                        <thead>
                            <tr>
                                <th class="trade-select-header is-hidden"><input type="checkbox" id="trades-select-all" aria-label="Select all visible trades" disabled></th>
                                <th class="sortable" data-sort="ticker">Ticker</th>
                                <th class="sortable" data-sort="strategy">Strategy</th>
                                <th class="sortable" data-sort="strikePrice">Strike</th>
                                <th class="sortable" data-sort="quantity">Qty</th>
                                <th class="sortable" data-sort="entryPrice">Net Credit/Debit</th>
                                <th class="sortable" data-sort="entryDate">Entry Date</th>
                                <th class="sortable" data-sort="expirationDate">Expiration Date</th>
                                <th class="sortable" data-sort="dte">DTE</th>
                                <th class="sortable" data-sort="exitDate">Exit Date</th>
                                <th class="sortable" data-sort="daysHeld">Days Held</th>
                                <th class="sortable" data-sort="maxRisk">Max Risk</th>
                                <th class="sortable" data-sort="pl">P&L</th>
                                <th class="sortable" data-sort="roi">ROI</th>
                                <th class="sortable" data-sort="annualizedROI">Annual ROI</th>
                                <th class="sortable" data-sort="status">Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Import View -->
            <div class="view import-view">
                <section class="import-section">
                    <header class="import-header">
                        <h2>Import Trade Activity</h2>
                        <p>Bring in broker exports without overwriting your existing database. OFX files are merged into your current trades; JSON imports create a brand new database.</p>
                    </header>
                    <div class="import-actions">
                        <button type="button" class="btn btn--primary" id="import-ofx-btn">Import OFX‚Ä¶</button>
                        <button type="button" class="btn btn--secondary" id="import-json-btn">Import JSON‚Ä¶</button>
                    </div>
                    <section class="import-stats" aria-live="polite">
                        <h3>Latest Import Summary</h3>
                        <div id="import-summary" class="import-summary"></div>
                    </section>
                    <section class="import-feedback" aria-live="polite">
                        <h3>Recent Imports</h3>
                        <div id="import-log" class="import-log" role="status"></div>
                    </section>
                    <section class="import-merge import-merge--hint" aria-live="polite">
                        <h3>Merge Trades After Import</h3>
                        <p id="import-merge-hint" class="import-merge__help">Review trades flagged for manual merge on the All Trades page after completing an import.</p>
                        <button type="button" class="btn btn--secondary" id="import-merge-hint-btn">Review Merge Opportunities</button>
                    </section>
                    <section class="import-help">
                        <h3>OFX Tips</h3>
                        <ul>
                            <li>Download activity reports from your broker in the OFX/QFX format.</li>
                            <li>Multi-leg option trades that share a timestamp are grouped automatically.</li>
                            <li>Closing legs update any open positions with matching strikes and expirations.</li>
                        </ul>
                    </section>
                </section>
            </div>

            <!-- Settings View -->
            <div class="view settings-view">
                <section class="settings-section">
                    <header class="settings-section__header">
                        <h2>Integration Settings</h2>
                        <p>Manage live data connections and other preferences that stay on this device.</p>
                    </header>
                    <div class="settings-card" id="finnhub-controls">
                        <div class="settings-card__header">
                            <h3>Finnhub API Key</h3>
                            <p class="settings-card__subtitle">We encrypt your key locally before storing it in this browser.</p>
                        </div>
                        <div class="settings-card__body">
                            <label for="finnhub-api-key" class="form-label">API Key</label>
                            <div class="settings-input-row">
                                <input type="password" id="finnhub-api-key" class="form-control finnhub-input" placeholder="Paste API key" autocomplete="off">
                                <button class="btn btn--sm btn--secondary" id="finnhub-save">Save Key</button>
                            </div>
                            <p class="settings-help-text">The key never leaves your machine. Clearing browser storage will remove it.</p>
                            <div class="finnhub-status" id="finnhub-status" role="status">Not set</div>
                        </div>
                    </div>
                    <div class="settings-card" id="gemini-controls">
                        <div class="settings-card__header">
                            <h3>Gemini API</h3>
                            <p class="settings-card__subtitle">Store a Google Gemini-compatible API key to enable AI portfolio insights.</p>
                        </div>
                        <div class="settings-card__body">
                            <label for="gemini-api-key" class="form-label">API Key</label>
                            <div class="settings-input-row">
                                <input type="password" id="gemini-api-key" class="form-control" placeholder="Paste API key" autocomplete="off">
                                <button class="btn btn--sm btn--primary" id="gemini-save">Save Key</button>
                                <button class="btn btn--sm btn--secondary" id="gemini-clear">Clear</button>
                            </div>
                            <div class="form-group">
                                <label for="gemini-model" class="form-label">Model</label>
                                <select id="gemini-model" class="form-control">
                                    <option value="gemini-2.5-flash-lite">Gemini 2.5 Flash Lite</option>
                                    <option value="gemini-2.5-flash">Gemini 2.5 Flash</option>
                                    <option value="gemini-2.5-pro">Gemini 2.5 Pro</option>
                                </select>
                            </div>
                            <p class="settings-help-text">Keys stay on this device. Use Google AI Studio or any compatible service exposing the Gemini generateContent API.</p>
                            <div class="gemini-status" id="gemini-status" role="status">Not set</div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Hidden file input for fallback -->
    <input type="file" id="file-input" accept=".json" style="display: none;">
    <input type="file" id="import-ofx-input" accept=".ofx,.OFX" style="display: none;">
    <input type="file" id="import-json-input" accept=".json" style="display: none;">

    <div class="ai-chat" id="ai-chat">
        <button type="button" class="ai-chat__toggle" id="ai-chat-toggle" aria-controls="ai-chat-panel" aria-expanded="false">
            ü§ñ AI Coach
        </button>
            <div class="ai-chat__panel hidden" id="ai-chat-panel" aria-hidden="true">
            <div class="ai-chat__resize-handle" id="ai-chat-resize-handle" role="presentation" aria-hidden="true"></div>
                <div class="ai-chat__header">
                    <div>
                        <h3 id="ai-chat-title" class="ai-chat__title">Portfolio AI Coach</h3>
                        <p id="ai-chat-subtitle" class="ai-chat__subtitle"></p>
                    </div>
                <button type="button" class="ai-chat__close" id="ai-chat-close" aria-label="Close AI chat">√ó</button>
            </div>
            <div class="ai-chat__body" id="ai-chat-history" aria-live="polite"></div>
            <form class="ai-chat__form" id="ai-chat-form">
                <input type="text" id="ai-chat-input" class="ai-chat__input" placeholder="Ask about your portfolio..." autocomplete="off" required>
                <button type="submit" class="btn btn--primary ai-chat__send">Send</button>
            </form>
            <div class="ai-chat__quick" id="ai-chat-quick">
                <span class="ai-chat__quick-label">Quick prompts:</span>
                <div class="ai-chat__quick-buttons">
                    <button type="button" class="ai-chat__quick-btn" data-ai-prompt="Analyze my portfolio's overall health with a focus on liquidity, volatility exposure, and capital utilization. Identify my most vulnerable open trade.">Portfolio health</button>
                    <button type="button" class="ai-chat__quick-btn" data-ai-prompt="Identify my largest concentration risk and suggest a specific strategy to reduce that position's leverage or exposure, referencing Max Drawdown.">Risk check</button>
                    <button type="button" class="ai-chat__quick-btn" data-ai-prompt="Based on my top-performing strategies, recommend a specific adjustment to my strategy mix to reduce losses or improve ROI.">Strategy ideas</button>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>

</html>